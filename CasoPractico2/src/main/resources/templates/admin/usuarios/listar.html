<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Usuarios</title>
</head>
<body>
    <div th:fragment="contenido">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>
                <i class="fas fa-users me-2"></i>
                Gestión de Usuarios
            </h2>
            <a th:href="@{/admin/usuarios/nuevo}" class="btn btn-primary">
                <i class="fas fa-user-plus me-2"></i>
                Nuevo Usuario
            </a>
        </div>
        
        <!-- Barra de búsqueda -->
        <div class="card shadow mb-4">
            <div class="card-body">
                <form th:action="@{/admin/usuarios}" method="get" class="row g-3">
                    <div class="col-md-4">
                        <label for="search" class="form-label">Buscar</label>
                        <div class="input-group">
                            <input type="text" id="search" name="search" 
                                   class="form-control" placeholder="Nombre, email o apellido"
                                   th:value="${searchTerm}">
                            <button type="submit" class="btn btn-outline-primary">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="rol" class="form-label">Filtrar por Rol</label>
                        <select id="rol" name="rol" class="form-select" onchange="this.form.submit()">
                            <option value="">Todos los roles</option>
                            <option value="ADMIN" th:selected="${selectedRol == 'ADMIN'}">Administrador</option>
                            <option value="PROFESOR" th:selected="${selectedRol == 'PROFESOR'}">Profesor</option>
                            <option value="ESTUDIANTE" th:selected="${selectedRol == 'ESTUDIANTE'}">Estudiante</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="estado" class="form-label">Filtrar por Estado</label>
                        <select id="estado" name="estado" class="form-select" onchange="this.form.submit()">
                            <option value="">Todos</option>
                            <option value="true" th:selected="${selectedEstado == 'true'}">Activos</option>
                            <option value="false" th:selected="${selectedEstado == 'false'}">Inactivos</option>
                        </select>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <a th:href="@{/admin/usuarios}" class="btn btn-secondary w-100">
                            <i class="fas fa-redo me-1"></i>
                            Limpiar
                        </a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Estadísticas rápidas -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="text-white-50">Total Usuarios</h6>
                                <h3 th:text="${#lists.size(usuarios)}">0</h3>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-users fa-2x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="text-white-50">Activos</h6>
                                <h3 th:text="${usuarios.?[activo == true].size()}">0</h3>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-user-check fa-2x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="text-white-50">Administradores</h6>
                                <h3 th:text="${usuarios.?[rol.nombre == 'ADMIN'].size()}">0</h3>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-user-shield fa-2x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="text-white-50">Estudiantes</h6>
                                <h3 th:text="${usuarios.?[rol.nombre == 'ESTUDIANTE'].size()}">0</h3>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-user-graduate fa-2x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tabla de usuarios -->
        <div class="card shadow">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-list me-2"></i>
                    Lista de Usuarios
                    <span class="badge bg-secondary ms-2" th:text="${#lists.size(usuarios)}">0</span>
                </h5>
            </div>
            <div class="card-body">
                <div th:if="${#lists.isEmpty(usuarios)}" class="text-center py-5">
                    <i class="fas fa-users-slash fa-3x text-muted mb-3"></i>
                    <h4 class="text-muted">No hay usuarios registrados</h4>
                    <p class="text-muted">Comienza creando tu primer usuario</p>
                    <a th:href="@{/admin/usuarios/nuevo}" class="btn btn-primary mt-3">
                        <i class="fas fa-user-plus me-2"></i>
                        Crear Primer Usuario
                    </a>
                </div>
                
                <div th:unless="${#lists.isEmpty(usuarios)}" class="table-responsive">
                    <table class="table table-hover table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th width="5%">ID</th>
                                <th>Nombre Completo</th>
                                <th>Email</th>
                                <th>Rol</th>
                                <th>Estado</th>
                                <th>Fecha Registro</th>
                                <th width="15%">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="usuario : ${usuarios}">
                                <td th:text="${usuario.id}">1</td>
                                <td>
                                    <strong th:text="${usuario.nombre} + ' ' + ${usuario.apellido}">Carlos Ramírez</strong>
                                </td>
                                <td th:text="${usuario.email}">c.ramirez@correo.com</td>
                                <td>
                                    <span class="badge" 
                                          th:classappend="${usuario.rol.nombre == 'ADMIN' ? 'bg-primary' : 
                                                          usuario.rol.nombre == 'PROFESOR' ? 'bg-info' : 
                                                          'bg-success'}"
                                          th:text="${usuario.rol.nombre}">ADMIN</span>
                                </td>
                                <td>
                                    <span th:if="${usuario.activo}" class="badge bg-success">
                                        <i class="fas fa-check-circle me-1"></i>
                                        Activo
                                    </span>
                                    <span th:unless="${usuario.activo}" class="badge bg-danger">
                                        <i class="fas fa-times-circle me-1"></i>
                                        Inactivo
                                    </span>
                                </td>
                                <td class="fecha-formateada" th:text="${usuario.fechaCreacion}">01/01/2023</td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a th:href="@{/admin/usuarios/detalle/{id}(id=${usuario.id})}" 
                                           class="btn btn-info" title="Ver detalle">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a th:href="@{/admin/usuarios/editar/{id}(id=${usuario.id})}" 
                                           class="btn btn-warning" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a th:href="@{/admin/usuarios/eliminar/{id}(id=${usuario.id})}" 
                                           class="btn btn-danger btn-delete" 
                                           title="Eliminar"
                                           onclick="return confirm('¿Estás seguro de eliminar a ' + '${usuario.nombre}' + '?')">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Paginación (simulada) -->
                <div th:if="${not #lists.isEmpty(usuarios)}" class="d-flex justify-content-between align-items-center mt-3">
                    <div>
                        <small class="text-muted">
                            Mostrando <span th:text="${#lists.size(usuarios)}">0</span> de 
                            <span th:text="${#lists.size(usuarios)}">0</span> usuarios
                        </small>
                    </div>
                    <nav aria-label="Paginación">
                        <ul class="pagination pagination-sm mb-0">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        
        <!-- Acciones masivas -->
        <div th:if="${not #lists.isEmpty(usuarios)}" class="card shadow mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-tasks me-2"></i>
                    Acciones Masivas
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <button class="btn btn-outline-success w-100" disabled>
                            <i class="fas fa-toggle-on me-2"></i>
                            Activar Seleccionados
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-danger w-100" disabled>
                            <i class="fas fa-toggle-off me-2"></i>
                            Desactivar Seleccionados
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-primary w-100" onclick="exportToCSV()">
                            <i class="fas fa-file-export me-2"></i>
                            Exportar a CSV
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts específicos para listar usuarios -->
    <div th:fragment="scripts">
        <script>
            function exportToCSV() {
                alert('Exportando lista de usuarios a CSV...\n(En producción, esto generaría un archivo descargable)');
                
                // Simulación de exportación
                const data = [
                    ['ID', 'Nombre', 'Apellido', 'Email', 'Rol', 'Estado', 'Fecha Registro'],
                    ['1', 'Carlos', 'Ramírez', 'c.ramirez@correo.com', 'ADMIN', 'Activo', '2023-01-01'],
                    ['2', 'Ana', 'Soto', 'ana.soto@correo.com', 'ESTUDIANTE', 'Activo', '2023-01-02'],
                    ['3', 'Luisa', 'Fernández', 'l.fernandez@correo.com', 'PROFESOR', 'Activo', '2023-01-03']
                ];
                
                const csvContent = data.map(row => row.join(',')).join('\n');
                console.log('CSV generado:', csvContent);
                
                // Mostrar notificación
                showNotification('success', 'Exportación completada', 'Los datos han sido exportados correctamente.');
            }
            
            // Función para filtrar en tiempo real
            document.getElementById('search')?.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
        </script>
    </div>
</body>
</html>